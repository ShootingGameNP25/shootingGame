import java.awt.Color;
import java.awt.Dimension;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import javax.swing.JTextField;

public class ChatPanel extends Background{
	private JTextField txtInput;
	private JTextArea textArea;
	private GameClient client;
	
	public ChatPanel() {
		super("chatBack.png");
		
		setLayout(null);
		
		setPreferredSize(new Dimension(280, 450));
		
		JScrollPane scrollPane = new JScrollPane();
		scrollPane.setBounds(20, 32, 239, 338);
		scrollPane.setOpaque(false); //스크롤 패널 자체 투명화
		scrollPane.getViewport().setOpaque(false); // 투명화
		scrollPane.setBorder(null); // 테두리 없애기
		add(scrollPane);
		
		textArea = new JTextArea();
		textArea.setEditable(false);
		textArea.setOpaque(false);
		textArea.setLineWrap(true); // 자동 줄바꿈
		textArea.setForeground(Color.WHITE);
		scrollPane.setViewportView(textArea);
		
		Myaction action = new Myaction();
		txtInput = new JTextField();
		txtInput.setBounds(20, 404, 238, 33);
		add(txtInput);
		txtInput.addActionListener(action);
		
	}
	
	public void setGameClient(GameClient client) {
		this.client = client;
	}
	
	public void appendChat(String msg) {
		textArea.append(msg + "\n");
		
		// textArea 객체의 텍스트의 총 길이를 저장
		int pos = textArea.getText().length();
		
		// caret 포지션을 가장 마지막으로 맞춤
		textArea.setCaretPosition(pos);
		
		// 입력창으로 포커스 줌
		txtInput.requestFocus();
	}
	
	class Myaction implements ActionListener{
		@Override
		public void actionPerformed(ActionEvent e) {
			if(e.getSource() == txtInput) {
				String msg = txtInput.getText().trim(); // 공백 제거
	            
	            // 빈 메시지가 아닐 때만 전송
	            if (msg.length() > 0) {
	            	
	            	// client 널값 방지
	            	if(client != null) {
	            		client.sendChat(msg);
	            	}
	            	
	            	// 입력창 비우기
	                txtInput.setText(""); 
	            }
			}
		}
	}
}
